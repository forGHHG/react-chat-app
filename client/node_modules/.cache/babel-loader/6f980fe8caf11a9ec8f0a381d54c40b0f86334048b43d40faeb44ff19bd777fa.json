{"ast":null,"code":"import _toConsumableArray from\"C:/Users/mhcho1/Desktop/react-Project/chat-app/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/mhcho1/Desktop/react-Project/chat-app/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from\"react\";import queryString from'query-string';import io from'socket.io-client';import Infobar from\"../InfoBar/Infobar\";import Messages from\"../Messages/Messages\";import Input from\"../Input/Input\";import TextContainer from\"../TextContainer/TextContainer\";import'./Chat.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var socket;var ENDPOINT='https://react-cha-server.fly.dev/';var Chat=function Chat(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),name=_useState2[0],setName=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),room=_useState4[0],setRoom=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),users=_useState6[0],setUsers=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),message=_useState8[0],setMessage=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),messages=_useState10[0],setMessages=_useState10[1];useEffect(function(){var _queryString$parse=queryString.parse(window.location.search),name=_queryString$parse.name,room=_queryString$parse.room;socket=io(ENDPOINT);setName(name);setRoom(room);// 'join'으로 name과 room 정보 송신\nsocket.emit('join',{name:name,room:room},function(error){// 콜백함수 정의\nif(error){window.location.replace(\"\".concat(process.env.PUBLIC_URL,\"/\"));alert(error);}});return function(){socket.emit('disconnect');socket.off();};},[ENDPOINT,window.location.search]);useEffect(function(){socket.on('message',function(message){setMessages([].concat(_toConsumableArray(messages),[message]));});socket.on('roomData',function(_ref){var users=_ref.users;setUsers(users);});},[messages]);var sendMessage=function sendMessage(event){event.preventDefault();if(message){socket.emit('sendMessage',message,function(){return setMessage('');});}};return/*#__PURE__*/_jsxs(\"div\",{className:\"outerContainer\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(Infobar,{room:room}),/*#__PURE__*/_jsx(Messages,{messages:messages,name:name}),/*#__PURE__*/_jsx(Input,{message:message,setMessage:setMessage,sendMessage:sendMessage})]}),/*#__PURE__*/_jsx(TextContainer,{users:users})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","queryString","io","Infobar","Messages","Input","TextContainer","jsx","_jsx","jsxs","_jsxs","socket","ENDPOINT","Chat","_useState","_useState2","_slicedToArray","name","setName","_useState3","_useState4","room","setRoom","_useState5","_useState6","users","setUsers","_useState7","_useState8","message","setMessage","_useState9","_useState10","messages","setMessages","_queryString$parse","parse","window","location","search","emit","error","replace","concat","process","env","PUBLIC_URL","alert","off","on","_toConsumableArray","_ref","sendMessage","event","preventDefault","className","children"],"sources":["C:/Users/mhcho1/Desktop/react-Project/chat-app/client/src/components/Chat/Chat.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport queryString from 'query-string';\r\nimport io from 'socket.io-client';\r\n\r\nimport Infobar from \"../InfoBar/Infobar\";\r\nimport Messages from \"../Messages/Messages\";\r\nimport Input from \"../Input/Input\";\r\nimport TextContainer from \"../TextContainer/TextContainer\";\r\n\r\nimport './Chat.css';\r\n\r\nlet socket;\r\nconst ENDPOINT = 'https://react-cha-server.fly.dev/';\r\n\r\nconst Chat = () => {\r\n    const [name, setName] = useState('');\r\n    const [room, setRoom] = useState('');\r\n    const [users, setUsers] = useState('');\r\n    const [message, setMessage] = useState([]);\r\n    const [messages, setMessages] = useState([]);\r\n\r\n    useEffect(() => {\r\n        const {name, room} = queryString.parse(window.location.search);\r\n\r\n        socket = io(ENDPOINT);\r\n\r\n        setName(name);\r\n        setRoom(room);\r\n\r\n        // 'join'으로 name과 room 정보 송신\r\n        socket.emit('join', {name, room}, (error) => {\r\n            // 콜백함수 정의\r\n            if (error) {\r\n                window.location.replace(`${process.env.PUBLIC_URL}/`);\r\n                alert(error);\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            socket.emit('disconnect');\r\n            socket.off();\r\n        }\r\n        \r\n    }, [ENDPOINT, window.location.search]);\r\n\r\n    useEffect(() => {\r\n        socket.on('message', (message) => {\r\n            setMessages([...messages, message]);\r\n        });\r\n\r\n        socket.on('roomData', ({users}) => {\r\n            setUsers(users);\r\n        })\r\n\r\n    }, [messages])\r\n\r\n    const sendMessage = (event) => {\r\n        event.preventDefault();\r\n\r\n        if (message) {\r\n            socket.emit('sendMessage', message, () => setMessage(''));\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"outerContainer\">\r\n            <div className=\"container\">\r\n                <Infobar room={room} />\r\n                <Messages messages={messages} name={name}/>\r\n                <Input message={message} setMessage={setMessage} sendMessage={sendMessage} />\r\n            </div>\r\n            <TextContainer users={users} />\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Chat;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}